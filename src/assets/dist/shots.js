(()=>{"use strict";Craft.Emails.Shots=Garnish.Base.extend({modal:null,init:function(){this.initModal(),this.initViewEmails(),this.initDelete(),this.initSend()},initModal:function(){this.modal=new Garnish.Modal($("#emails-modal"),{autoShow:!1}),$("#emails-modal .js-close").click((()=>{this.modal.hide()}))},initViewEmails:function(){$(".js-view").click((t=>{t.preventDefault(),$.ajax({url:Craft.getActionUrl("emails/cp-shots/shot-emails"),data:{id:$(t.target).data("id")}}).done((t=>{0==t.emails.length?$("#emails-modal .content").html("<p>"+Craft.t("emails","No emails for this shot")+"</p>"):$("#emails-modal .content").html(Craft.Emails.formatEmails(t.emails)),this.modal.show()}))}))},initDelete:function(){$(".js-delete").click((t=>{t.preventDefault();let e=$(t.target).data("id"),a=$(t.target);confirm(Craft.t("emails","Are you sure you want to delete this email shot ?"))&&$.ajax({url:Craft.getActionUrl("emails/cp-shots/delete"),data:{id:e},dataType:"json"}).fail((function(t){Craft.Emails.handleError(t)})).done((function(t){t.message&&Craft.cp.displayNotice(t.message),a.parent().parent().parent().remove(),0==$("#shots-table-view tbody tr").length&&($("#shots-table-view").remove(),$("#content").append("<p>"+Craft.t("emails","No email shots found")+"</p>"))}))}))},initSend:function(){$(".js-send").click((function(t){t.preventDefault();let e=$(this).data("id"),a=$(this);confirm(Craft.t("emails","Are you sure you want to send this email shot now?"))&&($(this).find(".spinner").show(),$(this).attr("disabled",!0),$.ajax({url:Craft.getActionUrl("emails/cp-shots/send"),data:{id:e},dataType:"json"}).fail((function(t){Craft.Emails.handleError(t)})).done((function(t){t.message&&Craft.cp.displayNotice(t.message),t.error&&Craft.cp.displayError(t.error)})).always((function(){a.find(".spinner").hide(),a.attr("disabled",!1)})))}))}})})();