Craft.Emails={handleError:function(e){e.hasOwnProperty("responseJSON")?e.responseJSON.hasOwnProperty("message")?Craft.cp.displayError(e.responseJSON.message):e.responseJSON.hasOwnProperty("error")&&Craft.cp.displayError(e.responseJSON.error):e.hasOwnProperty("statusText")&&Craft.cp.displayError(e.statusText)},formatEmails:function(e){var n="";for(var t in e)n+="<div><a href=mailto:"+t+">"+t+(e[t]?" ("+e[t]+")":"")+"</a></div>";return n},EmailsField:Garnish.Base.extend({$container:null,init:function(e){this.$container=$("#"+e),this.initAddEmail(),this.initElem(this.$container.find(".email-element"))},initAddEmail:function(){this.$container.find(".js-add-email").click((()=>{this.addEmail()}))},addEmail:function(){let e=this.$container.find(".elements .email-element").length,n=this.$container.find(".skeleton").clone().removeClass("skeleton"),t=n.find(".name-input").attr("name"),i=n.find(".email-input").attr("name");n.find(".name-input").attr("disabled",!1).attr("name",t+"["+e+"][name]"),n.find(".email-input").attr("disabled",!1).attr("name",i+"["+e+"][email]"),this.$container.find(".elements").append(n),n.slideDown("fast"),n.find("input").first().focus(),this.initElem(n)},initElem:function(e){e.find(".delete").on("click",(e=>{$(e.target).parent().slideUp("fast",(()=>{$(e.target).parent().remove(),this.rebuildNames()}))}))},rebuildNames:function(){let e,n,t,i,a;$.each(this.$container.find(".elements .email-element"),((r,s)=>{e=$(s).find(".name-input").attr("name"),i=[...e.matchAll(/\[[0-9]+\]/g)],n=i[i.length-1][0],t=e.lastIndexOf(n),a=e.substring(0,t)+"["+r+"]"+e.substring(t+n.length),$(s).find(".name-input").attr("name",a),e=$(s).find(".email-input").attr("name"),i=[...e.matchAll(/\[[0-9]+\]/g)],n=i[i.length-1][0],t=e.lastIndexOf(n),a=e.substring(0,t)+"["+r+"]"+e.substring(t+n.length),$(s).find(".email-input").attr("name",a)}))}})};