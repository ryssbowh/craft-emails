(()=>{"use strict";Craft.Emails.EmailLogs=Garnish.Base.extend({selection:[],deleteAction:null,viewAction:null,modal:null,init:function(t){this.deleteAction=t.deleteAction,this.viewAction=t.viewAction,this.initSelect(),this.initSelectAll(),this.initDeleteAll(),this.initDeleteSelection(),this.initView(),this.initModal(),this.initResend()},initDeleteAll:function(){$(".js-delete-all").click((t=>{t.preventDefault();var e=$(t.target).data("id");confirm(Craft.t("emails","Are you sure you want to delete all logs?"))&&$.ajax({url:Craft.getActionUrl(this.deleteAction),data:{id:e},dataType:"json"}).fail((function(t){Craft.Emails.handleError(t)})).done((function(t){location.reload()}))}))},initDeleteSelection:function(){$(".js-delete-selection").click((t=>{t.preventDefault();var e=$(t.target).data("id");confirm(Craft.t("emails","Are you sure you want to delete these logs?"))&&$.ajax({url:Craft.getActionUrl(this.deleteAction),data:{id:e,ids:this.selection},dataType:"json"}).fail((function(t){Craft.Emails.handleError(t)})).done((function(t){location.reload()}))}))},initSelectAll:function(){$(".js-select-all").click((t=>{var e=$(t.target).is(":checked");$.each($(".js-select"),((t,i)=>{$(i).prop("checked",e),e?this.select($(i).data("id")):this.unselect($(i).data("id"))}))}))},initView:function(){$(".js-view").click((t=>{t.preventDefault(),$.ajax({url:Craft.getActionUrl(this.viewAction),data:{id:$(t.target).data("id")}}).done((t=>{$("#emails-modal iframe")[0].src="data:text/html;charset=utf-8,"+t.body,$("#emails-modal .email-subject").html(t.subject),$("#emails-modal .email-to").html(Craft.Emails.formatEmails(t.to)),$("#emails-modal .email-cc").html(Craft.Emails.formatEmails(t.cc)),$("#emails-modal .email-bcc").html(Craft.Emails.formatEmails(t.bcc)),$("#emails-modal .email-from").html(Craft.Emails.formatEmails(t.from)),$("#emails-modal .email-replyto").html(Craft.Emails.formatEmails(t.replyTo));var e="";for(var i in t.attachements)e+='<div><a target="_blank" href="'+t.attachements[i].url+'">'+t.attachements[i].title+"</a></div>";$("#emails-modal .email-attachements").html(e),this.modal.show()})).fail((t=>{Craft.Emails.handleError(t)}))}))},initSelect:function(){$(".js-select").click((t=>{$(t.target).is(":checked")?this.select($(t.target).data("id")):this.unselect($(t.target).data("id"))}))},initModal:function(){this.modal=new Garnish.Modal($("#emails-modal"),{autoShow:!1}),$("#emails-modal .js-close").click((()=>{this.modal.hide()}))},initResend:function(){$(".js-resend").click((function(t){t.preventDefault();let e=$(this).data("id"),i=$(this);confirm(Craft.t("emails","Are you sure you want to resend this email now?"))&&($(this).find(".spinner").show(),$(this).attr("disabled",!0),$.ajax({url:Craft.getActionUrl("emails/cp-emails/resend"),data:{id:e},dataType:"json"}).fail((function(t){Craft.Emails.handleError(t)})).done((function(t){t.message&&Craft.cp.displayNotice(t.message)})).always((function(){i.find(".spinner").hide(),i.attr("disabled",!1)})))}))},toggleDeleteButton:function(){this.selection.length?$(".js-delete-selection").show():$(".js-delete-selection").hide()},select:function(t){this.selection.includes(t)||this.selection.push(t),this.toggleDeleteButton()},unselect:function(t){this.selection=this.selection.filter((e=>e!=t)),this.toggleDeleteButton(),$(".js-select-all").prop("checked",!1)}}),Craft.Emails.ShotLogs=Craft.Emails.EmailLogs.extend({initView:function(){$(".js-view").click((t=>{t.preventDefault(),$.ajax({url:Craft.getActionUrl("emails/cp-shots/log-emails"),data:{id:$(t.target).data("id")}}).fail((function(t){Craft.Emails.handleError(t)})).done((t=>{0==t.emails.length?$("#emails-modal .content").html("<p>"+Craft.t("emails","No emails for this log")+"</p>"):$("#emails-modal .content").html(Craft.Emails.formatEmails(t.emails)),this.modal.show()}))}))}})})();