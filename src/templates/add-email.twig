{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}
{% do view.registerAssetBundle("craft\\redactor\\assets\\redactor\\RedactorAsset") %}

{% set title = 'New email'|t('emails') %}
{% set fullPageForm = true %}
{% set errors = email.getErrors() %}
{% set emailSettings = craft.app.systemSettings.getSettings('email') %}

{% block toolbar %}
    <a href="{{ url('emails') }}" class="btn back">{{ 'Back'|t('app') }}</a>
{% endblock %}

{% block content %}
    {{ actionInput('emails/cp-emails/save-config') }}
    {{ forms.textField({
        label: 'Key'|t('emails'),
        name: 'key',
        value: email.key,
        disabled: email.system,
        errors: errors['key'] ?? [],
        required: true,
        fieldClass: 'first'
    }) }}
    {{ forms.selectField({
        label: 'Body Redactor config'|t('emails'),
        instructions: 'You can save custom Redactor configs as .json files in config/redactor/'|t('emails'),
        options: settings.redactorConfigOptions,
        required: true,
        errors: errors['redactorConfig'] ?? [],
        name: 'redactorConfig'
    }) }}
    {% if 'heading' in settings.configDriven %}
        {{ forms.textField({
            label: 'Heading'|t('emails'),
            name: 'heading',
            value: email.heading,
            required: true,
            errors: errors['heading'] ?? []
        }) }}
    {% endif %}
    {% if 'from' in settings.configDriven %}
        {{ forms.autosuggestField({
            label: 'Email from'|t('emails'),
            type: 'email',
            name: 'from',
            value: email.from,
            suggestEnvVars: true,
            placeholder: emailSettings.fromEmail,
            errors: errors['from'] ?? []
        }) }}
    {% endif %}
    {% if 'fromName' in settings.configDriven %}
        {{ forms.autosuggestField({
            label: 'Name from'|t('emails'),
            name: 'fromName',
            value: email.fromName,
            suggestEnvVars: true,
            placeholder: emailSettings.fromName,
            errors: errors['fromName'] ?? []
        }) }}
    {% endif %}
    {% if 'replyTo' in settings.configDriven %}
        {{ forms.autosuggestField({
            label: 'Reply to email'|t('emails'),
            type: 'email',
            name: 'replyTo',
            value: email.replyTo,
            suggestEnvVars: true,
            placeholder: emailSettings.replyToEmail ?? emailSettings.fromEmail,
            errors: errors['replyTo'] ?? []
        }) }}
    {% endif %}
    {% if 'cc' in settings.configDriven %}
        {{ forms.autosuggestField({
            label: 'Cc'|t('emails'),
            name: 'cc',
            value: email.cc,
            suggestEnvVars: true,
            instructions: 'Comma separated emails'|t('emails'),
            errors: errors['cc'] ?? []
        }) }}
    {% endif %}
    {% if 'bcc' in settings.configDriven %}
        {{ forms.autosuggestField({
            label: 'Bcc'|t('emails'),
            name: 'bcc',
            value: email.bcc,
            suggestEnvVars: true,
            instructions: 'Comma separated emails'|t('emails'),
            errors: errors['bcc'] ?? []
        }) }}
    {% endif %}
    {% if 'subject' in settings.configDriven %}
        {{ forms.textareaField({
            label: 'Subject'|t('emails'),
            name: 'subject',
            value: email.subject,
            instructions: 'Subject of the email, twig supported'|t('emails'),
            errors: errors['subject'] ?? []
        }) }}
    {% endif %}
    {% if 'body' in settings.configDriven %}
        {{ forms.textareaField({
            label: 'Body'|t('emails'),
            name: 'body',
            value: email.body,
            instructions: 'Content of the email, twig supported'|t('emails'),
            inputAttributes: {id: 'field-body'},
            errors: errors['body'] ?? []
        }) }}
    {% endif %}
    {{ forms.lightswitchField({
        label: 'Save logs'|t('emails'),
        name: 'saveLogs',
        on: email.saveLogs,
        instructions: 'Save logs of sent emails. You will be able to resend emails if this is enabled.'|t('emails'),
        errors: errors['saveLogs'] ?? []
    }) }}
{% endblock %}

{% js on ready %}
    $R('#field-body');
{% endjs %}

{% css %}
    #toolbar {
        justify-content: end;
    }
{% endcss %}